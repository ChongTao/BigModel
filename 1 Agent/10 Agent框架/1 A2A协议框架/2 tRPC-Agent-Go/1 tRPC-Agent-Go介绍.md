# 1 trpc-a2a-go 框架简介

[trpc-a2a-go](https://github.com/trpc-group/trpc-a2a-go)是一个实现 Agent-to-Agent (A2A) 协议的 Go 语言框架，用于构建 AI Agent 之间的通信系统。它基于 HTTP + JSON-RPC 2.0 协议，支持同步请求和 SSE (Server-Sent Events) 流式响应。

## 1.1 功能介绍

```lua
┌─────────────────────────────────────────────────────────────────────────────┐
│                        trpc-a2a-go 框架架构                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐         ┌─────────────────────────────────────────────┐   │
│  │   Client    │◀───────▶│                  Server                     │   │
│  │  (A2A客户端) │  HTTP   │                (A2A服务端)                   │   │
│  └─────────────┘ JSON-RPC└─────────────────────────────────────────────┘   │
│                                         │                                   │
│                                         ▼                                   │
│                          ┌─────────────────────────────┐                   │
│                          │      TaskManager            │                   │
│                          │      (任务管理器)            │                   │
│                          │  ┌───────────────────────┐  │                   │
│                          │  │ Memory / Redis 实现   │  │                   │
│                          │  └───────────────────────┘  │                   │
│                          └──────────────┬──────────────┘                   │
│                                         │                                   │
│                                         ▼                                   │
│                          ┌─────────────────────────────┐                   │
│                          │    MessageProcessor         │                   │
│                          │    (用户业务逻辑)            │                   │
│                          └─────────────────────────────┘                   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 1.2 核心特性

1. 标准 A2A 协议支持
   - message/send - 发送消息
   - message/stream - 流式消息
   - tasks/get - 获取任务
   - tasks/cancel - 取消任务
   - tasks/resubscribe - 重新订阅
   - tasks/pushNotificationConfig/* - 推送通知配置

2. 灵活的任务管理
   - 多任务隔离：每个任务独立 Context，互不干扰
   - 状态管理：Submitted → Working → Completed/Failed/Canceled
   - 流式订阅：支持多个订阅者实时接收任务更新
   - 自动清理：过期会话和失败订阅者自动清理

# 2 tRPC-Agent-Go

[tRPC-Agent-Go](https://github.com/trpc-group/trpc-agent-go) 框架集成了LLM、智能规划器、会话管理、可观测性和丰富的工具生态系统。支持创建自主Agent和半自主Agent，具备推理能力、工具调用、子Agent协作和长期状态保持能力，为开发者提供构建智能应用的完整技术栈，更多介绍见[构建智能AI应用的Go语言Agent框架](https://mp.weixin.qq.com/s/OOvXiZbUojt4M5NwRMgmvw)。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/W7W9IgARmG8ay6WJ1eTNJ2PITY8RwmgNXzoCLLKQo0aKGkV4YrnGUwMjWsicQPZSWpqdOZkRnKMNlT6eiafBTM8g/640?wx_fmt=png&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1#imgIndex=4)

● Agent: 核心执行单元，负责处理用户输入并生成响应，提供智能推理引擎和任务编排能力，tRPC Agent支持单Agent（GraphAgent，LLMAgent）和Multi-Agent（ChainAgent，ParallelAgent，CycleAgent），并支持基于muti-agent-system进行串联。

● Runner: Agent 的执行器，负责管理Agent的生命周期管理、会话状态维护和事件流处理，串联 Session/Memory Service 等能力

● Model: Model模块提供了统一的LLM接口抽象，支持OpenAI兼容的API调用。通过标准化的接口设计，开发者可以灵活切换不同的模型提供商，实现模型的无缝集成和调用。该模块主要支持了OpenAI like接口的兼容性，已验证公司内外大多数接口。

● Tool:Tool模块提供了标准化的工具定义、注册和执行机制，使Agent能够与外部世界进行交互。支持同步调用（CallableTool）和流式调用（StreamableTool）两种模式，满足不同场景的技术需求， 提供各种工具能力FunctionTool、MCP、DuckDuckGo 等

● Session: Session模块提供了会话管理功能，用于维护Agent与用户交互过程中的对话历史和上下文信息。会话管理模块支持多种存储后端，包括内存存储和Redis存储

● Memory: 记录用户的长期记忆和个性化信息

● Knowledge: 知识管理核心组件，它实现了完整的RAG（检索增强生成）能力。该模块不仅提供了基础的知识存储和检索功能，还支持多种高级特性：

● 知识源管理：支持本地文件（Markdown、PDF、TXT等）、目录批量导入、网页抓取，智能识别输入类型。向量存储：提供内存存储（开发测试）、PostgreSQL 、pgvector、ElasticSearch。Embedding：集成OpenAI Embedding、Gemini Embedding，支持自定义模型，优化异步批处理性能。智能检索：语义相似度搜索，支持多轮对话上下文，结果重排序提升相关性。

● Planner: Planner模块为Agent提供智能规划能力，通过不同的规划策略增强Agent的推理和决策能力。支持内置思考模型、React结构化规划和自定义显式规划指导三种模式，使Agent能够更好地分解复杂任务和制定执行计划

● CodeExecutor：CodeExecutor模块为Agent提供代码执行能力，支持在本地环境或Docker容器中执行Python、Bash代码，使Agent具备数据分析、科学计算、脚本自动化等实际工作能力。

● Observability：集成OpenTelemetry标准，在Agent执行过程中自动记录详细的telemetry数据，支持全链路追踪和性能监控，内置诸多指标。

## 2.1 框架对比

```lua
┌─────────────────────────────────────────────────────────────────────────────┐
│                          trpc-a2a-go (基础层)                                │
│                                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐│
│  │   Server    │  │   Client    │  │ TaskManager │  │      Protocol       ││
│  │ (HTTP服务)   │  │ (HTTP客户端) │  │ (任务管理)   │  │ (A2A协议数据结构)   ││
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────────────┘│
│                                                                             │
│  功能：A2A 协议通信、任务生命周期管理、SSE 流式传输                            │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      │ 依赖
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      trpc-agent-go (应用层 - 增强功能)                        │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        Agent 系统 (核心增强)                          │   │
│  │  ┌───────────┐ ┌────────────┐ ┌─────────────┐ ┌──────────────────┐ │   │
│  │  │ LLMAgent  │ │ ChainAgent │ │ParallelAgent│ │   GraphAgent     │ │   │
│  │  │ (LLM封装) │ │ (链式编排)  │ │ (并行编排)   │ │  (图编排)        │ │   │
│  │  └───────────┘ └────────────┘ └─────────────┘ └──────────────────┘ │   │
│  │                                                                     │   │
│  │  ┌────────────────────────────────────────────────────────────────┐│   │
│  │  │                      A2AAgent (远程Agent)                       ││   │
│  │  │  封装 trpc-a2a-go/client，作为本地 Agent 调用远程 A2A 服务       ││   │
│  │  └────────────────────────────────────────────────────────────────┘│   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        Runner 执行器 (新增)                          │   │
│  │  • 会话管理 (Session Service)                                        │   │
│  │  • 记忆服务 (Memory Service)                                         │   │
│  │  • 产物服务 (Artifact Service)                                       │   │
│  │  • 事件流处理 (Event Stream)                                         │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        Tool 工具系统 (新增)                           │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ │   │
│  │  │ Function │ │   MCP    │ │DuckDuckGo│ │  Email   │ │   File   │ │   │
│  │  │  Tool    │ │  Tool    │ │  Search  │ │  Tool    │ │  Tool    │ │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                     其他增强模块 (新增)                               │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐ │   │
│  │  │ Planner  │ │ Memory   │ │Knowledge │ │ Session  │ │Telemetry │ │   │
│  │  │ (规划器)  │ │ (记忆)    │ │ (RAG)    │ │ (会话)   │ │ (监控)   │ │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘ └──────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                     A2A Server 封装 (增强)                           │   │
│  │  将 Agent + Runner 封装为 A2A 服务，提供 MessageProcessor 实现       │   │
│  │  支持 ADK 兼容模式、自定义消息转换器                                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

