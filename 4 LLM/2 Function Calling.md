# 一 定义

**Function Calling**（函数调用）是指让模型**根据用户输入，自动调用外部函数、API或自定义逻辑**，并将函数的执行结果返回给用户的过程。其核心目标是让 LLM 能够**安全、可控、自动化地执行任务**。

优点：

-  **结构化调用**： 参数格式 JSON，可直接执行，无需手写正则去提取。
- **上下文结合**：AI 能结合聊天上下文动态确定调用的函数和参数。
-  **多步交互**： 可以先调用一个函数获取数据，再调用另一个函数处理结果。
- **更智能的业务流程**： 扩展 AI 到自动化执行任务，而不仅是回答。

# 二 工作原理

1. 定义可用的函数
   - 告诉 AI 你有哪些函数、这些函数的参数格式（JSON）、用途。
2. 用户输入请求
   - 用户输入一句话，比如“给我生成一张猫的图片”。
3. AI 解析意图
   - 模型分析用户意图，决定是否调用某个函数，以及调用时需要的参数。
4. 返回函数调用结构
   - 模型不会直接回答，而是返回 `function_name` 和 `arguments`（JSON 格式参数）。
5. 应用执行函数
   - 你的程序收到这些信息，执行对应函数（比如接入 OpenWeather API 获取天气）。
6. 再交给 AI 生成自然语言回答
   - 用函数执行结果，再调用 AI 让它整合回复。

示例：假设定义了一个 `get_weather` 函数（获取天气）：

```json
{
  "name": "get_weather",   //  函数名称
  "description": "获取指定城市的实时天气",
  "parameters": {          // 函数参数
    "type": "object",
    "properties": {
      "city": { "type": "string", "description": "城市名称" }
    },
    "required": ["city"]
  }
}
```

当用户说：“帮我查看上海天气”，模型可能返回：

```json
{
  "name": "get_weather",
  "arguments": {
    "city": "上海"
  }
}
```

然后应用去执行 `get_weather("上海")`，拿到天气数据，再交给 AI 用自然语言输出给用户。

# 三 提示词模板

```json
你是一名智能助手，可以调用以下函数：
1. weather_api(city)
2. calculator(expression)

请按照以下格式输出：
Thought: 模型思考
Action: JSON格式函数调用
Observation: 函数返回结果
Final Answer: 最终答案

用户问题：帮我查上海今天温度并换算华氏度
```

**模型输出示例**：

```json
Thought: 先查询上海温度
Action: {"function_call":{"name":"weather_api","arguments":{"city":"Shanghai"}}}
Observation: 26°C
Thought: 转换为华氏度
Action: {"function_call":{"name":"calculator","arguments":{"expression":"26*9/5+32"}}}
Observation: 78.8°F
Final Answer: 上海今天温度约为78.8°F
```

# 四 常见应用场景

- 🔍 **实时信息获取**：天气、新闻、汇率、股票价格。
- 📊 **数据处理**：表格生成、分析、报告。
- 📅 **日程安排**：添加日程、提醒、会议记录。
- 🛒 **电商助手**：搜索商品、下单、查询快递。
- 🎨 **多模态处理**：调用绘图接口生成图片。

------

# 五 注意事项

- **安全性**：防止 AI 被引导调用危险函数。
- **参数验证**：即使模型给出了参数，也要做后端校验。
- **超时与异常处理**：函数调用失败时要优雅降级。
- **多步骤流程**：可结合多次调用实现复杂任务